<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê³ ê° ë§Œì¡±ë„ í†µí•© ì„¤ë¬¸</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f7f9fb;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background-color: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
    }

    h2 {
      text-align: center;
      color: #003366;
      margin-bottom: 20px;
    }

    input, select, textarea, button {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    button {
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    .success {
      color: green;
      font-weight: bold;
      text-align: center;
    }

    .error {
      color: red;
      text-align: center;
    }

    .survey-list {
      margin-top: 40px;
    }

    .survey-item {
      padding: 15px;
      border-bottom: 1px solid #ddd;
    }

    .survey-item h4 {
      margin: 0 0 5px 0;
    }

    .survey-item p {
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ“‹ ê³ ê° ë§Œì¡±ë„ ì„¤ë¬¸</h2>

    <form id="surveyForm">
      <label for="name">ì´ë¦„ (ì„ íƒ):</label>
      <input type="text" id="name" name="name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />

      <label for="satisfaction">ì„œë¹„ìŠ¤ ì „ë°˜ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”?</label>
      <select id="satisfaction" name="satisfaction" required>
        <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
        <option value="ë§¤ìš° ë§Œì¡±">ë§¤ìš° ë§Œì¡±</option>
        <option value="ë§Œì¡±">ë§Œì¡±</option>
        <option value="ë³´í†µ">ë³´í†µ</option>
        <option value="ë¶ˆë§Œì¡±">ë¶ˆë§Œì¡±</option>
        <option value="ë§¤ìš° ë¶ˆë§Œì¡±">ë§¤ìš° ë¶ˆë§Œì¡±</option>
      </select>

      <label for="opinion">ì¶”ê°€ ì˜ê²¬ì´ë‚˜ ê±´ì˜ì‚¬í•­ì´ ìˆë‹¤ë©´ ì ì–´ì£¼ì„¸ìš”:</label>
      <textarea id="opinion" name="opinion" rows="4" placeholder="ì˜ê²¬ ì…ë ¥"></textarea>

      <button type="submit">ì„¤ë¬¸ ì œì¶œ</button>
    </form>

    <div class="success" id="successMsg" style="display: none;">âœ… ì„¤ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.</div>
    <div class="error" id="errorMsg" style="display: none;">âŒ ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>

    <div class="survey-list">
      <h2>ğŸ“Š ì„¤ë¬¸ ê²°ê³¼</h2>
      <div id="surveyResults"></div>
    </div>
  </div>

  <script>
    const form = document.getElementById('surveyForm');
    const successMsg = document.getElementById('successMsg');
    const errorMsg = document.getElementById('errorMsg');
    const resultsContainer = document.getElementById('surveyResults');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        name: document.getElementById('name').value,
        satisfaction: document.getElementById('satisfaction').value,
        opinion: document.getElementById('opinion').value
      };

      try {
        const res = await fetch('/api/survey', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (res.ok) {
          successMsg.style.display = 'block';
          errorMsg.style.display = 'none';
          form.reset();
          loadSurveys();
        } else {
          throw new Error();
        }
      } catch (err) {
        successMsg.style.display = 'none';
        errorMsg.style.display = 'block';
      }
    });

    async function loadSurveys() {
      try {
        const res = await fetch('/api/survey');
        const surveys = await res.json();

        if (surveys.length === 0) {
          resultsContainer.innerHTML = "<p>ë“±ë¡ëœ ì„¤ë¬¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }

        resultsContainer.innerHTML = surveys.map(s => `
          <div class="survey-item">
            <h4>ğŸ§‘ ì´ë¦„: ${s.name || 'ìµëª…'}</h4>
            <p>ğŸ’¬ ë§Œì¡±ë„: ${s.satisfaction}</p>
            <p>ğŸ“ ì˜ê²¬: ${s.opinion}</p>
            <p>ğŸ•’ ì‘ì„±ì¼: ${new Date(s.date).toLocaleString()}</p>
          </div>
        `).join('');
      } catch (err) {
        resultsContainer.innerHTML = '<p class="error">ì„¤ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
      }
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ìœ¼ë¡œ ì„¤ë¬¸ ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = loadSurveys;
  </script>
</body>
</html>
