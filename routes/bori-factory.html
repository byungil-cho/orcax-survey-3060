<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒ¾ ë³´ë¦¬ ë†ì¥</title>
  <style>
body {
  margin: 0;
  font-family: 'Do Hyeon', sans-serif;
  background: url('https://byungil-cho.github.io/OrcaX/farm-201.png') no-repeat center top fixed;
  background-size: cover;
  color: #2d1800;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.scroll-area {
  background: rgba(255,255,255,0.25);
  border-radius: 28px;
  box-shadow: 0 4px 32px 0 rgba(50,30,10,0.20);
  margin: 2rem auto;
  padding: 2rem 1.2rem 2rem 1.2rem;
  max-width: 440px;
  width: 95vw;
  min-width: 270px;
  text-align: center;
  backdrop-filter: blur(3.5px);
}
header {
  font-size: 2.2rem;
  margin-bottom: 0.8rem;
  font-weight: bold;
  color: #53340f;
  letter-spacing: 0.5px;
  text-shadow: 1px 2px 12px #ffe9bc, 0 0 2px #633e17;
}
.nickname, .info-bar {
  font-size: 1.12rem;
  margin-bottom: 0.5rem;
  letter-spacing: -0.5px;
  color: #2e1b09;
  font-weight: 600;
  text-shadow: 0 1px 10px #ffecc2ad, 0 0 1px #fff7;
}
.barley-field {
  margin: 1.3rem 0 1.3rem 0;
  color: #321d0c;
}
.status {
  font-size: 1.17rem;
  margin-bottom: 1.1rem;
  font-weight: bold;
  text-shadow: 0 2px 12px #fff6;
}
.grow-buttons button,
#harvest-btn {
  margin: 0.18rem 0.45rem;
  padding: 0.8rem 1.5rem;
  font-size: 1.14rem;
  border-radius: 19px;
  border: none;
  cursor: pointer;
  background: #fffbf8e9;
  box-shadow: 0 1px 8px 0 #bdbdbd45;
  font-weight: bold;
  transition: background 0.14s;
}
.grow-buttons button:active,
#harvest-btn:active {
  background: #f9e7c7e8;
}
.storage-section {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  margin-bottom: 1.1rem;
}
.storage-section div {
  background: #fff9eebd;
  border-radius: 13px;
  padding: 0.65rem 0.3rem;
  font-size: 1.12rem;
  word-break: keep-all;
  color: #3c2107;
  box-shadow: 0 2px 7px #fff6;
  font-weight: 500;
}
.storage-section strong {
  color: #bb7e28;
}
.seedbarley-box {
  margin-top: 0.25rem;
  color: #3b240a;
  font-weight: 700;
  font-size: 1.07rem;
  background: #ffeec2a3;
  border-radius: 8px;
  padding: 0.28rem 0;
  box-shadow: 0 1px 5px #f9eab32c;
}
.nav-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.8rem;
  margin-top: 1.4rem;
}
.nav-buttons a {
  background: #fff6;
  border-radius: 15px;
  padding: 0.7rem 1.2rem;
  text-decoration: none;
  color: #795548;
  font-weight: bold;
  font-size: 1.09rem;
  box-shadow: 0 1px 8px 0 #0001;
  margin-bottom: 0.5rem;
  transition: background 0.14s, color 0.15s;
}
.nav-buttons a:hover {
  background: #ffefc7;
  color: #ae7c26;
}
@media (max-width: 600px) {
  .scroll-area {
    max-width: 99vw;
    min-width: 0;
    padding: 1.1rem 0.3rem 1.3rem 0.3rem;
  }
  header { font-size: 1.34rem; }
}
  </style>
</head>
<body>
  <div class="scroll-area">
    <header>ğŸŒ¾ ë³´ë¦¬ ë†ì¥ - Barley Farm</header>

    <div class="nickname">ğŸ‘¤ ë†ì¥ì£¼: <span id="nickname">-</span></div>
    <div class="info-bar">
      ğŸŒ ì „ì› ìƒíƒœ: <span id="power-status">í™•ì¸ ì¤‘...</span> |
      ğŸŒ¾ ë†ì¥ì´ë¦„: <span id="farm-name">-</span> |
      ğŸ’° í† í°: <span id="token">-</span>
    </div>

    <div class="barley-field">
      ğŸŒ± <span id="barley-status">ë³´ë¦¬ê°€ ìë¼ê³  ìˆìŠµë‹ˆë‹¤...</span>
      <div class="status">ì„±ì¥ í¬ì¸íŠ¸: <span id="growth">0</span></div>
      <div class="grow-buttons">
        <button onclick="applyWater()">ğŸ’§ ë¬¼ ì£¼ê¸°</button>
        <button onclick="applyFertilizer()">ğŸ’© ê±°ë¦„ ì£¼ê¸°</button>
      </div>
      <div id="harvest-container" style="margin-top: 1.5rem;"></div>
    </div>

    <div class="storage-section">
      <div>
        <strong>ğŸ“¦ ìì¬ ë³´ê´€í•¨</strong><br>
        ë¬¼: <span id="water">0</span>,
        ê±°ë¦„: <span id="fertilizer">0</span>
        <div class="seedbarley-box">ì”¨ë³´ë¦¬: <span id="seedBarley">0</span></div>
      </div>
      <div>
        <strong>ğŸ›’ ì œí’ˆ ë³´ê´€í•¨</strong><br>
        ë³´ë¦¬: <span id="barley">0</span>
      </div>
    </div>

    <div class="nav-buttons">
      <a href="gamja-result.html">ê°ì ë³´ë¦¬ ê°€ê³µê³µì¥</a>
      <a href="gamja-shop.html">ì”¨ê°ì ì”¨ë³´ë¦¬ êµ¬ë§¤</a>
      <a href="orcax-farm_000.html">ë©”ì¸ í˜ì´ì§€</a>
    </div>
  </div>

<script>
const API_URL = "https://climbing-wholly-grouper.jp.ngrok.io/api";
let kakaoId = localStorage.getItem("kakaoId") || "";
let nickname = localStorage.getItem("nickname") || "ìµëª…ë†ë¶€";
let farmName = localStorage.getItem("farmName") || "ë³´ë¦¬ë†ì¥";

document.getElementById("nickname").textContent = nickname;
document.getElementById("farm-name").textContent = farmName;
document.getElementById("power-status").textContent = "ì „ê¸° ê³µê¸‰ì¤‘ì…ë‹ˆë‹¤.";

let user = null;
let growthPoint = 0;

function updateDisplay() {
  document.getElementById("token").textContent = user.orcx ?? 0;
  document.getElementById("growth").textContent = user.growth?.barley ?? 0;
  document.getElementById("water").textContent = user.water ?? 0;
  document.getElementById("fertilizer").textContent = user.fertilizer ?? 0;
  document.getElementById("seedBarley").textContent = user.seedBarley ?? 0;
  document.getElementById("barley").textContent = user.barley ?? 0;

  // ìˆ˜í™• ë²„íŠ¼ í‘œì‹œ ì¡°ê±´
  showHarvestBtn(user.growth?.barley ?? 0);
  // ìƒíƒœ ë©”ì„¸ì§€
  if ((user.growth?.barley ?? 0) === 0) {
    document.getElementById("barley-status").textContent = "ë³´ë¦¬ê°€ ìë¼ê¸° ì‹œì‘í•©ë‹ˆë‹¤...";
  } else if ((user.growth?.barley ?? 0) < 4) {
    document.getElementById("barley-status").textContent = "ë³´ë¦¬ê°€ ë¬´ëŸ­ë¬´ëŸ­ ìë¼ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
  } else {
    document.getElementById("barley-status").textContent = "ë³´ë¦¬ ìˆ˜í™• ì¤€ë¹„ ì™„ë£Œ!";
  }
}

// ìœ ì € ë°ì´í„° ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
async function fetchUserData() {
  if (!kakaoId) return;
  const res = await fetch(API_URL + "/userdata", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ kakaoId })
  });
  const data = await res.json();
  if (data.success) {
    user = data.user;
    growthPoint = user.growth?.barley ?? 0;
    updateDisplay();
  } else {
    alert("ìœ ì € ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤!");
  }
}
fetchUserData();

// ë¬¼ ì£¼ê¸° ë²„íŠ¼
async function applyWater() {
  await growBarley("water");
}
// ê±°ë¦„ ì£¼ê¸° ë²„íŠ¼
async function applyFertilizer() {
  await growBarley("fertilizer");
}

// ì„±ì¥ í¬ì¸íŠ¸ +1 ì„œë²„ ì—°ë™
async function growBarley(action) {
  if (!kakaoId) return alert("ë¡œê·¸ì¸ ì •ë³´ ì—†ìŒ");
  const res = await fetch(API_URL + "/factory/grow", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ kakaoId, cropType: "barley", action })
  });
  const data = await res.json();
  if (data.success) {
    await fetchUserData();
  } else {
    alert(data.message || "ì„±ì¥ ì‹¤íŒ¨");
  }
}

// ìˆ˜í™•í•˜ê¸° ë²„íŠ¼ ë™ì‘
function showHarvestBtn(growth) {
  const c = document.getElementById("harvest-container");
  c.innerHTML = "";
  if (growth >= 4) {
    const btn = document.createElement("button");
    btn.textContent = "ğŸŒ¾ ìˆ˜í™•í•˜ê¸°";
    btn.id = "harvest-btn";
    btn.onclick = async function() {
      const res = await fetch(API_URL + "/factory/harvest", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ kakaoId, cropType: "barley" })
      });
      const data = await res.json();
      if (data.success) {
        alert(`ğŸ‰ ë³´ë¦¬ ${data.reward}ë§ì„ ìˆ˜í™•í–ˆìŠµë‹ˆë‹¤!`);
        await fetchUserData();
        c.innerHTML = "";
      } else {
        alert(data.message || "ìˆ˜í™• ì‹¤íŒ¨");
      }
    };
    c.appendChild(btn);
  }
}

// í˜ì´ì§€ ì§„ì… ì‹œ ìˆ˜í™• ë²„íŠ¼ë„ ë°˜ì˜
window.addEventListener("DOMContentLoaded", async () => {
  await fetchUserData();
});
</script>
</body>
</html>
